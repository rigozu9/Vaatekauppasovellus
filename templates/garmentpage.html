<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCD:</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='CCDLOGO.png') }}" type="image/x-icon">
    <link rel="shortcut icon" href="{{ url_for('static', filename='CCDLOGO.png') }}" type="image/x-icon">    
</head>
<body>
    {% include 'header.html' %}
    {% include 'search.html' %}

    <!-- Garment rendered here -->
    {% for item in clothing %}
        <li class="garmentpage-item">
            <!-- Display an image from the database -->
            <div class="slideshow-container">
                {% for image in item.images %}
                    <div class="mySlides fade">
                        <img class="garmentpage-image" src="data:image/jpeg;base64,{{ image.data | b64encode }}" alt="Clothing">
                    </div>
                {% endfor %}
                <!-- Next and previous buttons -->
                <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
                <a class="next" onclick="plusSlides(1)">&#10095;</a>
            </div>
            <div class="details-container">
                <h3><strong>{{ item.name }}</strong></h3>
                <p><strong>Category:</strong> {{ item.category }}</p>
                <p><strong>About the item:</strong> <br>{{ item.description }}</br></p>
                <p><strong>Size:</strong> {{ item.size }}</p>
                <p><strong>Price:</strong> {{ item.price }}€</p>
                <!-- links to check inquiries and modify or delete item. -->
                <!-- admin can delete or modify items -->
                {% if session.username %}
                    {% if session.username == item.username or session.username == admin.username %}
                        <p><a href="/chats/{{ session.username }}/{{ item.id }}">See inquiries</a></p>
                        <p><a href="/modify/{{ item.id }}">MODIFY ITEM</a></p>
                        <p><a href="/delete/{{ item.id }}" onclick="return confirm('Are you sure you want to delete this item?');">DELETE ITEM</a></p>
                    {% else %}
                        <!-- link to send messsage about the item -->
                        <p><strong>Listed by: </strong><a href="/users/{{ item.username }}">{{ item.username }}</a></p>
                        <button class="buy-button"><a href="/send_message/{{ session.username }}/{{ item.username }}/{{ item.id }}">Send a message about the item</a></button>
                        <div>
                            <button class="buy-button">
                                <a href="/buy/{{ item.id }}" onclick="return confirm('Are you sure you want to buy {{ item.name }} for {{ item.price }}€?');">Buy now for {{ item.price }}€</a>
                            </button>
                        </div>
                    {% endif %}
                {% else %}
                    <!-- link to send messsage about the item -->
                    <p><strong>Listed by: </strong><a href="/users/{{ item.username }}">{{ item.username }}</a></p>
                    <p><a href="/login">Login or register to send a message about the item</a></p>
                {% endif %}
            </div>
        </li>
    {% endfor %}

    {% if session.username %}
        <!-- User is logged in, show logout link -->
        <a class="usertab" href="/users/{{ session.username }}"> {{ session.username }}</a>
        <a class="logout" href="/logout">Sign out</a>
        <a class="sell" href="/new">Sell a garment</a>
        <a class="balance">Balance: {{ user.balance }}€</a>
    {% else %}
        <!-- User is not logged in, show login and register links -->
        <a class="login" href="/login">Sign in</a>
        <a class="register" href="/register">Register here</a>
    {% endif %}

    <!-- footer -->
    {% include 'footer.html' %}
</body>
<!-- Manual slideshow for the pictures -->
    <script>
        var slideIndex = 1;
        showSlides(slideIndex);

        function plusSlides(n) {
            showSlides(slideIndex += n);
        }

        function currentSlide(n) {
            showSlides(slideIndex = n);
        }

        function showSlides(n) {
            var i;
            var slides = document.getElementsByClassName("mySlides");
            if (n > slides.length) {slideIndex = 1}
            if (n < 1) {slideIndex = slides.length}
            for (i = 0; i < slides.length; i++) {
                slides[i].style.display = "none";
            }
            slides[slideIndex-1].style.display = "block";
        }
    </script>
</html>
